#!/bin/bash

if [ "$BUILD" = "windows" -o "$BUILD" = "linux" ]; then
  if [ "$BUILD" = "windows" ]; then
    args="-w --ia32"
  else
    args="-l --x64"
  fi

  docker run --rm \
    -e ELECTRON_CACHE=$HOME/.cache/electron \
    -v ${PWD}/electron:/project \
    -v ~/.cache/electron:/root/.cache/electron \
    -e NODE_ENV=production \
    electronuserland/builder:wine \
    /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn run dist ${args}"
else
  export NODE_ENV=production

  cd electron
  npm install -g yarn
  yarn
  yarn run dist
fi
